LICENSE: This file is available for text mining. It may also be used consistent with the principles of fair use under the copyright law.


101492446
35637
Proc IEEE Comput Soc Conf Comput Vis Pattern Recognit
Proc IEEE Comput Soc Conf Comput Vis Pattern Recognit
Proceedings. IEEE Computer Society Conference on Computer Vision and Pattern Recognition
1063-6919

28392672
5383000
10.1109/CVPR.2016.546
NIHMS771656
Article
Shape Analysis with Hyperbolic Wasserstein Distance
Shi Jie
Zhang Wen
Wang Yalin
School of Computing, Informatics, and Decision Systems Engineering Arizona State University
24 3 2016
12 12 2016
6 2016
06 4 2017
2016 50515061
This file is available for text mining. It may also be used consistent with the principles of fair use under the copyright law.

Shape space is an active research field in computer vision study. The shape distance defined in a shape space may provide a simple and refined index to represent a unique shape. Wasserstein distance defines a Riemannian metric for the Wasserstein space. It intrinsically measures the similarities between shapes and is robust to image noise. Thus it has the potential for the 3D shape indexing and classification research. While the algorithms for computing Wasserstein distance have been extensively studied, most of them only work for genus-0 surfaces. This paper proposes a novel framework to compute Wasserstein distance between general topological surfaces with hyperbolic metric. The computational algorithms are based on Ricci flow, hyperbolic harmonic map, and hyperbolic power Voronoi diagram and the method is general and robust. We apply our method to study human facial expression, longitudinal brain cortical morphometry with normal aging, and cortical shape classification in Alzheimer’s disease (AD). Experimental results demonstrate that our method may be used as an effective shape index, which outperforms some other standard shape measures in our AD versus healthy control classification study.


1. Introduction

Over the past decade, exciting opportunities have emerged in studying 3D imaging data thanks to the rapid progress made in 3D image acquisition. There is a crucial need to develop effective 3D shape indexing and classification techniques. Shape space models, which usually measure similarities between two shapes by the deformation between them, may provide a suitable mathematical and computational description for shape analysis (as reviewed in [67]). In computer vision research, shape space has been well studied for brain atlas estimation [19, 18], shape analysis [33, 24, 56], morphometry study [69, 10], etc. Recently, the Wasserstein space is attracting more attention. The Wasserstein space is the space consisting of all the probability measures on a Riemannian manifold. The Wasserstein distance defines a Riemannian metric for the Wasserstein space and it intrinsically measures the similarities between shapes. The advantages of Wasserstein distance for 3D shape analysis research are: (1) the geodesic distance between space points gives a continuous and refined shape difference measure, which is particularly useful for brain imaging study, where higher accuracy is usually expected; (2) it studies a transport between two probability measures on a canonical image or manifold so it is robust to noise. It holds the potential to quantitatively measure 3D shapes reconstructed from images and provide a theoretical foundation for 3D shape analysis.

Wasserstein distance has been widely studied and applied in image and shape analysis. In [45], the Wasserstein distance was used to model local shape appearances and shape variances for joint variational object segmentation and shape matching. A linear optimal transportation (LOT) framework was introduced in [61], where a linearized version of the Wasserstein distance was used to measure the differences between images. Hong, et al. [28] used Wasserstein distance to encode the integral shape invariants computed at multiple scales and to measure the dissimilarities between two shapes. However, these methods only work with 2D images. In [5], the Wasserstein distance computation was generalized to Riemannian manifolds. Su, et al. [56] computed the Wasserstein distance between genus-0 surfaces, where the spherical conformal domain was used as the canonical space. On the other hand, a major limitation of Wasserstein distance is that its computational cost increases as the sizes of the problems increase. Cuturi, et al. [13] proposed to solve this problem with entropic regularization. In [51], the algorithm was extended to geometric domains for shape interpolation, surface soft maps, etc. To date, few studies have investigated Wasserstein distance defined on general topological surfaces.

In practice, most 3D shapes have complicated topology (high-genus). In brain imaging research, to enforce the alignment of the major anatomic features, one may slice surface open along certain landmark curves [50]. This procedure generates genus-0 surfaces with multiple open boundaries. The current state-of-the-art Wasserstein space research is unable to compute Wasserstein distance on these high-genus surfaces or genus-0 surfaces with multiple open boundaries. In this work, to overcome these limitations, we propose a novel framework by integrating hyperbolic Ricci flow [70, 49], hyperbolic harmonic map [50], surface tensor-based morphometry (TBM) [14, 12], and optimal mass transportation (OMT) map [31, 11]. We also extend the computation of the OMT map and the Wasserstein distance to the hyperbolic space, i.e., the Poincaré disk. We call the resulting Wasserstein distance the hyperbolic Wasserstein distance.

In this paper, we applied the hyperbolic Wasserstein distance to index and compare different 3D shapes. We tested our algorithm on genus-0 surfaces with multiple open boundaries, including human face surfaces with different expressions, longitudinal brain cortical morphology with normal aging, and cortical shape classification between Alzheimer’s disease (AD) patients and healthy control people. Experimental results demonstrated that the proposed method is promising to be a new shape analysis tool.

Our major contributions can be summarized as follows:

Propose a novel algorithm to compute Wasserstein distance between general surfaces with hyperbolic Riemannian metric.

Extend the OMT map to hyperbolic Poincaré space, which greatly enhance its applicability for general surface analysis.

Develop a general framework that may be applicable for other shape space work. Currently, most of shape space work were developed on genus-0 surfaces, e.g. [34, 24], which cannot be directly applied to high-genus surfaces because of the difficulty in building a canonical space for them. Our framework, which adopts a hyperbolic harmonic map to build diffeomorphic mappings between general surfaces, may be used to generalize other shape space studies to general surfaces as well.

1.1. Prior Work

Analysis and understanding of shapes is one of the most fundamental tasks in computer vision and medical imaging research. Many 3D shape indexing methods have been proposed and extensively applied. The spherical harmonic analysis [21, 55] and its extension, the weighted spherical harmonic representation [12], use spherical harmonics to match and compare shapes. But these methods require the surfaces to be homotopic to a sphere. The medial description of shapes [42, 54], which is composed of a set of medial samples (m-reps), is also widely applied. Wang et al. introduced a series of conformal invariants to represent and analyze shapes, which are the coordinates of surfaces in the Teichmüller space. The conformal invariants were computed with Euclidean Ricci flow [65] or hyperbolic Yamabe flow [64, 64] and no surface registration was required. In brain imaging studies, the volumes and surface areas of cortical or subcortical structures are often used as biomarkers to characterize brain morphometry associated with cognitive diseases [27].

The optimal mass transportation (OMT) problem was first raised by Monge, concerning to find an optimal way to move a pile of soil from one place to another with minimal transportation cost [9]. The existence and uniqueness of the solution for the OMT problem were proved in [31] using linear programming. The Monge-Kantorovich optimization has been widely applied in various fields, including physics, economics, computer science, etc. Specifically, the OMT map provides an important tool for image processing [25, 44]. Recently, the algorithm has been generalized to 3D surfaces for area-preserving mappings [71, 57] and Wasserstein distance computation [56, 58]. However, existing methods only work on genus-0 surfaces, while our algorithm extends the OMT problem to general surfaces with hyperbolic metric.

Kendall [32] pioneered the manifold shape space research. In computational anatomy framework [22], the space of diffeomorphisms was carefully studied [40, 68]. In [53, 52], shape space was defined as the space of orbits of the reparameterization group acting on the space of immersions. The reparameterization invariant (RI) metric constructed in [8] used the volume form and the mean curvature of the immersion f, and the metric in [34] used the area multiplication factor of f. Kurtek et al. [35] extended the work in [34] by adding landmark constraints. Jermyn et al. [30] simplified the RI metric computation and Gutman et al. [24] built a Riemannian framework for an intrinsic comparison of the RI metric structure. Lipman and Daubechies [37] introduced a metric for shape comparison based on conformal uniformization and OMT. The metric is invariant under Möbius transformation. Later, Lipman et al. [38] provided a convergence analysis of the discrete approximation to the arising mass transportation problems. Mémoli [39] presented a modification and expansion of the original Gromov-Hausdorff notion of distance between metric spaces which considers probability measures defined on measurable subsets of metric spaces.

2. Theoretical Background

In this section, we briefly introduce the most relevant concepts and theories. For details, please refer to [23] for computational conformal geometry, and to [11, 31] for OMT map.

Conformal Deformation

Suppose S is a surface embedded in ℝ3 with induced Riemannian metric g. It can be verified that ḡ = e2ug is also a Riemannian metric on S and angles measured by ḡ are equal to those measured by g. Then ḡ is called a conformal deformation of g and u is the conformal factor. When metric changes, the surface Gaussian curvature K will change accordingly to K̄ = e−2u(−Δgu + K), where Δg=e-2u(∂2∂x2+∂2∂y2) is the Laplace-Beltrami operator induced by g. According to the Gauss-Bonnet theorem [15], the total Gaussian curvature is determined by the surface topology, i.e., ∫S KdA = 2πχ(S), where χ(S) is the Euler characteristic of S and dA is the surface area element.

Uniformization Theorem

Given {S, g}, there exist an infinite number of metrics which are conformal to g. The uniformization theorem states that, among all conformal metrics, there is a unique representative, which induces constant Gaussian curvature everywhere. Furthermore, the constant will be one of {−1, 0, 1}. The corresponding metric is called the uniformization metric of S. Thus, we can embed the universal covering space of any closed surface to one of three canonical spaces using its uniformization metric: the sphere 𝕊2 for genus-0 surfaces with positive Euler numbers; the Euclidean plane 𝔼2 for genus-1 surfaces with Euler number zero; and the hyperbolic space ℍ2 for high-genus surfaces with negative Euler numbers.

Surface Ricci Flow

The uniformization metric of a surface can be computed by the Ricci flow method. The normalized surface Ricci flow is defined as dg(t)dt=(4πχ(S)A(0)-2K(t))g(t), where A(0) is the total area of S at time 0 and K(t) is the Gaussian curvature induced by g(t). It has been proved that if χ(S) &lt; 0, the solution to the normalized Ricci flow equation exists for all t &gt; 0 and converges to a metric with constant Gaussian curvature 2πχ(s)A(0) [26]. Thus, the hyperbolic uniformization metric of a surface, which introduces −1 Gaussian curvature everywhere, can be computed by the Ricci flow.

Hyperbolic Geometry

As the hyperbolic space ℍ2 cannot be realized in ℝ3, we use the Poincaré disk model to visualize it. The Poincaré disk is a unit disk on the complex plane {z ∈ ℂ, |z| &lt; 1} with Riemannian metric ds2=dzdz¯(1-zz¯)2. The hyperbolic distance between two points in the Poincaré disk is defined as

(1) dist(z1,z2)=tanh-1|z1-z21-z1z2¯|

A geodesic (hyperbolic line) is an arc on a circle that is perpendicular to the unit circle. The rigid motion in the Poincaré disk is the Möbius transformation

(2) z→eiθz-z01-z0¯z

Another hyperbolic model is the Klein disk, where hyperbolic lines coincide with Euclidean lines. The conversion from the Poincaré disk to the Klein model is

(3) z→2z1+zz¯

Fuchsian Group

Suppose {S, g} is a surface with a negative Euler characteristic and its hyperbolic uniformization metric is ḡ. Let p ∈ S be a base point, two loops through p are homotopic, if one can deform to the other without leaving S. All the homotopic classes of loops starting from p form a simply connected surface S̄. Then the universal covering space of S, {S̄, ḡ}, can be isometrically embedded in ℍ2. A Fuchsian transformation ϕ is a Möbius transformation that maps a universal covering space S̄ to another and preserves the projection ϕ ∘ p = p. All Fuchsian transformations form the Fuchsian group, Fuchs(S).

Harmonic Map

Given a surface {S, g}, if the coordinates (x, y) satisfy g = e2u(x, y)(dx2 + dy2), where u is the conformal factor, (x, y) are called the isothermal coordinates. Consider a map f : {S1, g1} → {S2, g2}, z and w are the local isothermal coordinates on S1 and S2, respectively. We denote f(z) = w and g1 = σ(z)dzdz̄, g2 = ρ(w)dwdw̄, where z, w ∈ ℂ and z = x + iy, w = u + iv, dz = dx + idy, dz̄ = dx − idy. The harmonic energy of the map f is defined as

(4) E(f)=∫S1ρ(f(z))(∣fz∣2+∣fz¯∣2)dxdy

where fz=12(∂f∂x-i∂f∂y),fz¯=12(∂f∂x+i∂f∂y).

If f is a critical point of the harmonic energy, then it is called a harmonic map. The necessary condition for f to be a harmonic map is the Euler-Lagrange equation fzz¯+ρfρfzfz¯≡0. The following theorem [46] shows that harmonic maps with hyperbolic metrics are beneficial for general surface registration study.

Theorem 1 (Yau)

Suppose f : {S1, g1} → {S2, g2} is a degree one harmonic map, furthermore, the Riemannian metric on S2 induces negative Gaussian curvature, then for each homotopy class, the harmonic map is unique and diffeomorphic.

Optimal Mass Transportation Map

Given a Riemannian manifold {S, g}, let μ and ν be two probability measures on S with the same total mass, i.e., ∫S μdx = ∫S νdx, let ϕ : S → S be a diffeomorphic map, then the pull back measure induced by ϕ is ϕ*ν = det(J)ν ∘ ϕ, where J is the Jacobian matrix of ϕ. If the pull back measure satisfies ϕ*ν = μ, then the map ϕ is measure preserving. The transportation cost of ϕ is defined as

(5) Cost(ϕ)=∫Sdg2(p,ϕ(p))μ(p)dx

where p is a vertex on S and dg(p, ϕ(p)) is the geodesic distance between p and its image ϕ(p) with respect to the metric g. The OMT problem tries to find the measure preserving mapping, which uses minimal transportation cost (Eq. [5]).

Wasserstein Space and Wasserstein Distance

Given a Riemannian manifold {S, g}, the Wasserstein space is defined as:

Definition 1 (Wasserstein Space)

Let Pn(S) denote the space of all probability measures μ on S with finite nth moment, where n ≥ 1. Suppose there exists some point p0 ∈ S, such that ∫Sdg2(p,p0)μ(p)dx&lt;+∞.

Given two measures μ and ν in Pn(S), the Wasserstein distance between them is defined as the cost of the OMT map ϕ : Sμ → Sν.

(6) Wn(μ,ν)=infϕ∗ν=μ(∫Sdgn(p,ϕ(p))μ(p)dx)1n

Theorem 2 [60]

The Wasserstein distance Wn is a Riemannian metric of the Wasserstein space Pn(S).

3. Computational Algorithms

In this section, we explain the computation framework of the hyperbolic Wasserstein distance. We use genus-0 surfaces with multiple boundaries as examples to illustrate our algorithm. The pipeline is summarized in Algorithm 1 and illustrated in Fig. 1.

Algorithm 1 Hyperbolic Wasserstein Distance Computation Pipeline.

Slice the surface open along some delineated landmark curves to generate a genus-0 surface with multiple boundaries (Fig. 1 (a)).

Compute the hyperbolic uniformization metric of the surface with hyperbolic Ricci flow.

Isometrically embed the surface onto the Poincaré disk and convert it to the Klein model (Fig. 1 (b)–(c)).

With the Klein model, construct the initial mapping between the surface and a template surface with the constrained harmonic map.

Improve the initial mapping with hyperbolic harmonic map to obtain a global diffeomorphic mapping on the Poincaré disk (Fig. 1 (d)).

Compute the OMT map between the surface and the template surface with the hyperbolic power Voronoi diagram, where the surface tensor-based morphometry of the hyperbolic harmonic map is used as a measure (Fig. 1 (e)).

Compute the hyperbolic Wasserstein distance between the surface and the template surface.

	

3.1. Topology Optimization

Surfaces with negative Euler characteristics admit hyperbolic geometry. For closed surfaces with genus g ≥ 2, we can directly compute their hyperbolic uniformization metric with hyperbolic Ricci flow. For genus-0 surfaces, we usually slice them open along multiple (3 or more) boundaries, as shown in Fig. 1 (a). This process is called topology optimization and is usually applied in medical imaging research [49, 66, 50], where landmark curve matchings are often enforced across subjects.

3.2. Discrete Hyperbolic Ricci Flow

In engineering fields, smooth surfaces are often represented as triangular meshes. Given a triangular mesh M(V, E, F), where V, E, and F are the sets of vertices, edges, and faces, respectively, we use vi to denote a vertex, eij to denote the edge connecting vi and vj, fijk to denote the triangle formed by vi, vj, and vk, and θijk to denote the corner angle attached to vi in the face fijk.

The edge lengths of the mesh M define the discrete Riemannian metric l : E → ℝ+, and for each face fijk, the edge lengths satisfy the triangle inequality lij + ljk &gt; lki.

The discrete Gaussian curvature Ki on a vertex vi ∈ M can be computed by the angle deficit

(7) Ki={2π-∑fijk∈Fθijk,vi∉∂Mπ-∑fijk∈Fθijk,vi∈∂M

where ∂M represents the boundary of M.

Theoretically, a conformal deformation maps infinitesimal circles to infinitesimal circles and preserves the intersection angles among the circles. In computation, we use circles with finite radii to approximate infinitesimal circles. The circle packing metric [59] of a mesh M assigns a circle radius ri to each vertex vi and a weight ϕij to each edge eij, which is the intersection angle of the two circles defined on vi and vj.

With the hyperbolic geometry, we treat each face as a hyperbolic triangle and the corner angles are computed by the hyperbolic cosine law. The discrete hyperbolic Ricci flow algorithm is described in Algorithm 2.

Algorithm 2 Discrete Hyperbolic Ricci Flow

For each vertex vi, assign an initial value to ri; for each edge eij, compute the value of its weight function ϕij with the hyperbolic cosine law cos(ϕij)=cosh(lij)-cosh(ri)cosh(rj)sinh(ri)sinh(rj); initialize the conformal factor ui on each vertex vi as 0.

Compute the edge length lij with the above hyperbolic cosine law.

Compute the corner angle θijk with the inverse hyperbolic cosine law θijk=cos-1cosh(lij)cosh(lki)-cosh(ljk)sinh(lij)sinh(lki).

Compute the discrete Gaussian curvature Ki of each vertex vi with Eq. [7].

Update the conformal factor with uit+1=uit-ΔtKi.

Update the vertex radius with ri = 2tanh−1(eui).Repeat steps 2 to 6, until |K| of all vertices are less than a user-specified threshold.

Output the hyperbolic uniformization metric.

	

For details of the hyperbolic Ricci flow algorithm, please refer to [70, 49].

3.3. Initial Map Construction

With the hyperbolic uniformization metric, we can isometrically embed the surface onto the Poincaré disk, as shown in Fig. 1 (b). Briefly, we select a seed face f012 ∈ M and embed its three vertices in the Poincaré disk as p(v0) = (0, 0), p(v1)=el01-1el01+1(1,0),p(v2)=el02-1el02+1(cosθ012,sinθ012). Then we put all un-embedded faces that are adjacent to current face in a queue. We pop a face fijk from the queue, if all its vertices are embedded, then continue to pop next face; otherwise, suppose vi, vj are embedded, then p(vk) is computed as the intersection between two hyperbolic circles, which center at p(vi), p(vj) and with radii lki, lkj, respectively, satisfying (p(vj) − p(vi)) × (p(vk) − p(vi)) &gt; 0. We continue to do so until the queue is empty. By converting the embedding to the Klein model (Eq. [3]), we obtain a hyperbolic polygon, where all the hyperbolic lines coincide with Euclidean straight lines, as shown in Fig. 1 (c). With the Klein model, we construct the initial map between a surface and the template surface using the constrained harmonic map [66, 49, 50]. Briefly, suppose M and N are two homotopic surfaces and both of them are mapped to the Klein disk. A map f : M → N is harmonic if Δf = 0. To solve the Laplace equation, corresponding boundaries of the two Klein polygons are treated as boundary conditions and are enforced to be aligned with linear interpolation by the arc length parameter. With the discrete finite element definition of the Laplace operator, the initial map can be constructed by solving a sparse linear system [47]. As indicated in [46], if the target domain is convex, the planar harmonic maps are diffeomorphic. Thus, the initial map is diffeomorphic.

3.4. Hyperbolic Harmonic Map

We then diffuse the initial map to form the hyperbolic harmonic map [50]. Given two surfaces M and N with hyperbolic metrics gM and gN, respectively, we denote their local isothermal coordinates as z and w. Suppose f : M → N is the initial map, locally, it can be written as f(z) = w. Then the diffusion process is given by the following gradient descent method

(8) df(z,t)dt=-[fzz¯+ρw(w)ρ(w)fzfz¯]

where ρ(w)=1(1-ww¯)2 is the hyperbolic metric in the Poincaré disk. Algorithm 3 gives the detailed computation steps. A hyperbolic harmonic map example is illustrated in Fig. 1 (d).

Algorithm 3 Hyperbolic Harmonic Map

Given two surfaces (M, gM) and (N, gN), where gM and gN are hyperbolic metrics in the Poincaré disk. There is a one-to-one correspondence between these two surfaces, (mi, ni), where mi and ni are vertices on M and N, respectively.

For each pair of corresponding vertices mi ∈ M and ni ∈ N, embed their one-ring neighboring vertices onto the Poincaré disk. Let zi and wi = f(zi) denote the 2D coordinates of mi and ni in the Poincaré disk, respectively.

Compute dwi(zi,t)dt with Eq. [8].

Update wit+1=wit-εdwi(zi,t)dt.

Compute the new 3D coordinate of ni with the new wi.

Repeat steps 2 to 5, until dwi(zi,t)dt is less than a user-specified threshold.

	

3.5. Surface Tensor-based Morphometry

In this work we use surface tensor-based morphometry (TBM) [14, 12] to define the probability measure on the Poincaré disk. Suppose f : M → N is the hyperbolic harmonic map between surfaces M and N. The derivative map of f is the linear map between the tangent spaces df : TM(p) → TM(f(p)), induced by f, which also defines the Jacobian matrix of f. With triangular meshes, the derivative map df is approximated by the linear map from one face [vi, vj, vk] to another [wi, wj, wk]. First, we isometrically embed the faces onto the Poincaré disk, where the planar coordinates of vi and wi are denoted by the same symbols vi and wi. Then the Jacobian matrix of the map f can be computed explicitly [62]

(9) J=df=[w3-w1,w2-w1][v3-v1,v2-v1]-1

Then the TBM is defined as det(J). TBM measures the amount of local area changes in a surface with respect to the map f [12].

3.6. Optimal Mass Transportation Map and Hyperbolic Wasserstein Distance

As shown in [56, 58], the OMT map between two probability measures that are defined on surfaces can be computed by the power Voronoi diagram [16]. Here we use the hyperbolic space as the canonical space and TBM as the measure to compute the power Voronoi diagram on the Poincaré disk.

Given a surface S with the Riemannian metric g, let P = {p1, p2, …, pn} be a set of n discrete points on S and w = {w1, w2, …, wn} be the weights defined on each point.

Definition 2 (Power Voronoi Diagram)

Given a point set P and its corresponding weight vector w, the power Voronoi diagram induced by (P, w) is a cell decomposition of the surface (S, g), such that the cell spanned by pi is given by

(10) Celli={x∈S∣dg2(x,pi)-wi≤dg2(x,pj)-wj},j=1,…,nandi≠j

In this work, with the Poincaré disk model, the geodesic distance dg between two points is defined by Eq. [1]. The term dg2(x,pi)-wi is called the power distance between x and pi. Figure 2 (a) shows the power distance on the Euclidean plane. Figure 2 (b) illustrates the power Voronoi diagram on the Poincaré disk.

Theorem 3

Given a Riemannian manifold (S, g), μ and ν represent two probability measures defined on S and they have the same total mass. ν is a Dirac measure, with discrete point set support P = {p1, p2, …, pn} and ν(pi) = νi. Then there exists a weight vector w = {w1, w2, …, wn}, unique up to a constant, such that the power Voronoi diagram induced by (P, w) gives the OMT map between μ and ν: ψ:Celli→pi,i=1,2,…,n

and

∫Celliμ(x)dx=νi,∀i∈[1,…,n].

The proof of Theorem 3 can be found in [58].

The optimal weight for the power Voronoi diagram that induces the OMT map can be computed by

(11) dwidt=νi-∫Celliμ(x)dx,x∈S.

Algorithm 4 gives the details about the OMT map computation with hyperbolic metric. Figure 1 (e) illustrates the hyperbolic power Voronoi diagram that results in the OMT map between the cortical surface in Fig. 1 (a) and a template surface. In Fig. 1 (e), the black points form the discrete point set P. The initial hyperbolic geodesic Voronoi diagram is computed by the method in [41].

Algorithm 4 Optimal Mass Transportation Map

Given a triangular mesh M with hyperbolic metric g on the Poincaré disk, define a measure μ and a Dirac measure (P, ν) = {(pi, νi)}, i = 1, 2, …, n, ∫Mμ(x)dx=∑i=1nνi.

For each pi ∈ P, compute it geodesic distances to every other vertex on M with Eq. [1].For each vertex vi ∈ M, determine which Voronoi cell it belongs to with Eq. [10].For each pi ∈ P, compute the total mass of the measures in the cell spanned by it, μi = ∫Celli μ(x)dx.

Update each weight by wit+1=wit+ε(νi-μi).

Repeat steps 3 to 5, until |νi − μi|, ∀i, is less than a user-specified threshold.

	

The cost of the OMT map computed by Algorithm 4 gives the Wasserstein distance between two measures. With the hyperbolic metric, we define the hyperbolic Wasserstein distance between two measures that are defined on the Poincaré disk by

(12) Wasserstein(μ,ν)=∑i=1n∫Celli(tanh-1|x-pi1-xpi¯|)2μ(x)dx.

4. Experimental Results

The proposed method is quite efficient. For example, for cortical surfaces each with 100k faces, the average running time of major steps is summarized in Table 1. The experiments were executed on a PC with 3.6 GHz Intel(R) Core(TM) i7-4790 CPU and 64-bit Windows 7 operating system.

4.1. Human Facial Expression Analysis

In the first experiment, we applied our method to study 3D human face expression. Human facial expression modeling is an interesting problem studied for a long time [17]. The goal is to discriminate and describe different human facial expressions. It is useful for face recognition and dynamical facial animation research.

We picked three face meshes from the BU-3DFE Database [1], including an angry face (Fig. 3 (a)), a happy face (Fig. 3 (b)), and a happier face (Fig. 3 (c)), which all belong to a randomly selected sample. On each face surface, we removed two eyes and the mouth along their boundaries, a common approach used in 3D face modeling [70]. The resulting facial surface became a genus-0 surface with four open boundaries. We used the happy face as the template surface to compute the hyperbolic harmonic map and the OMT map. First, we ran hyperbolic Ricci flow on the three surfaces and isometrically embedded them on the Poincaré disk, as shown in Fig. 3 (d–f). Then, the angry and happier faces were registered to the happy face with the hyperbolic harmonic map (Fig. 3 (g)). Finally, with the TBM measures, we constructed the OMT maps between both faces and the template face with the hyperbolic power Voronoi diagram (Fig. 3 (h)). Later, the hyperbolic Wasserstein distances between the angry face and the template face, between the happier face and the template face, were computed as the costs of respective OMT maps. Intuitively, the happier face is more similar to the template, thus it should have smaller Wasserstein distance. The experimental results verify our intuition, where the hyperbolic Wasserstein distances for the angry face and happier faces are 25.94 and 11.75, respectively. Although multi-subject studies are clearly necessary, this experiment demonstrates that our hyperbolic Wasserstein distance may have the potential to quantify and measure human expression changes.

4.2. Longitudinal Cortical Morphometry Analysis

In this experiment, we applied the proposed algorithm to analyze cortical surface morphology in normal aging. Brain atrophy seems to be inevitable for elderly people [20]. However, a simple, non-invasive brain imaging biomarker would be beneficial to quantify brain morphometry patterns and identify abnormal changes potentially for early interventions.

We randomly selected an elderly heathy subject (85-year old male) from the Alzheimer’s Disease Neuroimaging Initiative (ADNI) [29]. We studied the longitudinal structural magnetic resonance image (MRI) at three time points, the baseline, 12 months, and 24 months after screening. The MRIs were preprocessed using FreeSurfer [3] to reconstruct the cortical surfaces. Only the left hemispheric cerebral cortices were used here. Six major brain landmark curves were automatically labeled on each cortical surface with the Caret software [2], including the Central Sulcus, Anterior Half of the Superior Temporal Gyrus, Sylvian Fissure, Calcarine Sulcus, Medial Wall Ventral Segment, and Medial Wall Dorsal Segment, as shown in Fig. 4.

After we cut the cortical surfaces along the delineated landmark curves, they became genus-0 surfaces with six open boundaries. We used the baseline cortical surface as the template and did the same analysis as in Sec. 4.1. The hyperbolic power Voronoi diagrams for the 12-month and 24-month cortical surfaces are shown in Fig. 5. The hyperbolic Wasserstein distances between the template surface and the 12-month and 24-month surfaces are 132.28 and 201.70, respectively, revealing the cortex changing process along with normal aging [43]. This shows that our method may serve as an imaging index to study the longitudinal brain morphometry.

4.3. Cortical Shape Classification

We also applied our hyperbolic Wasserstein distance to study the classification problem with cortical surfaces between healthy control subjects and Alzheimer’s disease (AD) patients. We randomly selected 30 AD patients and 30 healthy controls from the ADNI1 baseline dataset. The inclusive rules were based on segmentation and reconstruction result quality of the FreeSurfer package [3]. Only left hemispheric cortices were studied here, as some prior research, e.g. [48], has identified a trend that AD related brain atrophy may starts from left side and subsequently extends to the right. We randomly selected the left cortical surface of a healthy control subject, who is not in our 60 studied subject dataset, as the template surface. Similar to Sec. 4.2, Caret was used to automatically identify six landmark curves on each cortical surface. After cutting open the cortical surfaces along the landmark curves, we modeled each left hemispheric cortical surface as a genus-0 surface with six open boundaries and computed the hyperbolic Wasserstein distance between each cortical surface and the common template surface.

With the computed hyperbolic Wasserstein distances, we applied the complex tree in the Statistics and Machine Learning Toolbox of MATLAB [4] as a classifier. With a 5-fold cross validation, the classification rate of our method is 76.7%. As a comparison, we also computed two other standard cortical surface shape features, the cortical surface area and cortical surface volume, which have been widely used in shape classification [6, 36]. We applied the same classifier on the two measurements with 5-fold cross validation. Their results are summarized in Table 2. It can be noticed that our method significantly outperformed them. Generally speaking, the discrimination of the AD progression and normal aging is challenging, but has numerous benefits to help design early interventions. Whether or not our approach provides a more accurate way to quantify the cortical changes than those afforded by other criteria (such as SPHARM [55], radial distance [7], or Teichmüller shape space coordinates [65, 64, 63]) requires careful validation for each application. If statistical power is increased in shape feature representation, this would support the use of 3D modeling techniques in advanced brain imaging research. Meanwhile, our work may build a theoretical foundation to extend other shape space work to general surfaces to further improve AD imaging biomarkers for preclinical AD research.

5. Conclusion and Future Work

This work introduces a novel algorithm to compute the Wasserstein distance between general surfaces with hyperbolic metric. With hyperbolic Ricci flow, hyperbolic harmonic map, surface TBM, and hyperbolic power Voronoi diagram, we computed the hyperbolic Wasserstein distance. Our work generalized the OMT and Wasserstein space work to general surfaces. In our experiments, we applied the algorithm to study human facial expression changes, cortical longitudinal morphometry and cortical shape classification in AD. In future, we will further validate our method with brain morphometry analysis on more 3D imaging data and human facial expression tracking study on BU-3DFE database [1]. We will also try to improve the performance of the algorithm by considering other probability measures for the OMT map, such as the multivariate tensor-based morphometry (mTBM) [62]. Furthermore, we will explore the possibility to use this framework to generalize other shape space work.

Figure 1 Algorithm pipeline: (a) slice a surface open along landmark curves to generate a genus-0 surface with multiple boundaries; (b) embed the surface onto the Poincaré disk with its hyperbolic uniformization metric, which is computed by the hyperbolic Ricci flow; (c) covert the Poincaré disk to the Klein model to construct the initial map between the surface and a template; (d) compute the hyperbolic harmonic map by diffusing the initial map; (e) compute the OMT map using hyperbolic power Voronoi diagram, with surface tensor-based morphometry as the probability measure, where the colored regions denote Voronoi cells.

Figure 2 Illustration of the power distance between two points on the Euclidean plane and the power Voronoi diagram on the Poincaré disk.

Figure 3 Experimental results of human facial expression analysis with hyperbolic Wasserstein distance.

Figure 4 Landmark curves on a left cortical surface, which are automatically labeled by Caret [2], showing in two different views.

Figure 5 Optimal mass transportation maps between the 12-month, 24-month cortical surfaces and baseline surface with hyperbolic power Voronoi diagram.

Table 1 Average running time of major steps in the proposed algorithm, on cortical surfaces each with 100k faces.

Step	Time	Step	Time	
hyper Ricci flow	20 sec	initial map	15 sec	
hyper harmonic	30–40 sec	hyper OMT	20–30 sec	

Table 2 Classification rate comparison of our method and two other cortical surface shape features, the cortical surface area and cortical surface volume. The results demonstrated an accuracy rate achieved by the proposed method.

Method	Classification Rate	
hyperbolic Wasserstein distance	76.7%	
Surface Area	41.7%	
Surface Volume	51.7%	


1 BU-3DFE Database http://www.cs.binghamton.edu/~lijun/Research/3DFE/3DFE_Analysis.html
2 Caret http://brainvis.wustl.edu/wiki/index.php/Caret:About
3 FreeSurfer http://freesurfer.net/
4 MATLAB Statistics and Machine Learning Toolbox http://www.mathworks.com/help/stats/examples/classification.html
5 Ambrosio L Gigli N A user’s guide to optimal transport Modelling and Optimisation of Flows on Networks 2062 1 155 2013
6 Andersen SK Jakobsen CE Pedersen CH Rasmussen AM Plocharski M RØtergaard L Classification of alzheimer’s disease from MRI using sulcal morphology Image Analysis 9127 103 113 2015
7 Apostolova LG Alves G Hwang KS Babakchanian S Bronnick JP Larsen K Thompson PM Chou Y-Y Tysnes OB Vefring HK Beyer MK Hippocampal and ventricular changes in Parkinson’s disease mild cognitive impairment Neurobiol Aging 33 9 2113 2124 2012 21813212
8 Bauer M Harms P Michor PW Almost local metrics on shape space of hypersurfaces in n-space SIAM Journal on Imaging Sciences 5 244 310 2012
9 Bonnotte N From Knothe’s rearrangement to Brenier’s optimal transport map arXiv:1205.1099 [math.OC] 1 29 2012
10 Boyer DM Lipman Y St Clair E Puente J Patel BA Funkhouser T Jernvall J Daubechies I Algorithms to automatically quantify the geometric similarity of anatomical surfaces Proc Natl Acad Sci USA 108 18221 18226 2011 22025685
11 Brenier Y Polar factorization and monotone rearrangement of vector-valued functions Communications on Pure and Applied Mathematics 44 4 375 417 1991
12 Chung MK Dalton KM Davidson RJ Tensor-based cortical surface morphometry via weighted spherical harmonic representation IEEE Trans Med Imaging 27 1143 1151 2008 18672431
13 Cuturi M Sinkhorn distances: Lightspeed computation of optimal transportation NIPS 26 2292 2300 2013
14 Davatzikos C Spatial normalization of 3D brain images using deformable models J Comput Assist Tomogr 20 656 665 1996 8708076
15 Do Carmo MP Differential Geometry of Curves and Surfaces Prentice-Hall, Inc 1976
16 Edelsbrunner H Algorithms in Combinatorial Geometry Springer-Verlag New York, Inc 1987
17 Essa IA Pentlan AP Coding, analysis, interpretation, and recognition of facial expressions IEEE Trans Pattern Anal Mach Intell 19 7 757 763 1997
18 Fletcher PT Geodesic regression and the theory of least squares on Riemannian manifolds Int J Comput Vis 105 2 171 185 2013
19 Fletcher PT Venkatasubramanian S Joshi S The geometric median on Riemannian manifolds with application to robust atlas estimation Neuroimage 45 1 Suppl S143 152 2009 19056498
20 Frisoni GB Fox NC Jack CR Scheltens P Thompson PM The clinical use of structural MRI in Alzheimer disease Nat Rev Neurol 6 2 67 77 2010 20139996
21 Gerig G Styner M Jones D Weinberger D Lieberman J Shape analysis of brain ventricles using SPHARM IEEE Workshop on Mathematical Methods in Biomedical Image Analysis 2001 (MMBIA 2001) 171 178 2001
22 Grenander U Miller MI Computational anatomy: an emerging discipline Quart Appl Math 56 617 694 1998
23 Gu X Yau S-T Computational Conformal Geometry International Press of Boston 2007
24 Gutman BA Fletcher PT Cardoso MJ Fleishman GM Lorenzi M Thompson PM Ourselin S A Riemannian framework for intrinsic comparison of closed genus-zero shapes Information Processing in Medical Imaging 9123 205 218 2015
25 Haker S Zhu L Tannenbaum A Angenent S Optimal mass transport for registration and warping Int J Comput Vis 60 3 225 240 2004
26 Hamilton RS The Ricci flow on surfaces Contemporary Mathematics 71 237 262 1988
27 Hibar DP Stein JL Renteriaand ME Arias-Vasquez A Common genetic variants influence human subcortical brain structures Nature 520 7546 224 229 2015 25607358
28 Hong BW Soatto S Shape matching using multiscale integral invariants IEEE Trans Pattern Anal Mach Intell 37 1 151 160 2015 26353215
29 Jack CR Bernstein MA Borowski BJ Gunter JL Fox NC Thompson PM Schuff N Krueger G Killiany RJ Decarli CS Dale AM Carmichael OW Tosun D Weiner MW Update on the magnetic resonance imaging core of the Alzheimer’s disease neuroimaging initiative Alzheimers Dement 6 3 212 220 2010 20451869
30 Jermyn IH Kurtek S Klassen E Srivastava A Elastic shape matching of parameterized surfaces using square root normal fields Proceedings of the 12th European Conference on Computer Vision - Volume Part V (ECCV’12) 7576 804 817 2012
31 Kantorovich LV On a problem of monge Uspekhi Mat Nauk 3 2 225 226 1948
32 Kendall DG The diffusion of shape Advances in Applied Probability 9 3 428 430 1977
33 Kurtek S Klassen E Ding Z Jacobson SW Jacobson JL Avison MJ Srivastava A Parameterization-invariant shape comparisons of anatomical surfaces IEEE Trans Med Imaging 30 3 849 858 2011 21156390
34 Kurtek S Klassen E Gore JC Ding Z Srivastava A Elastic geodesic paths in shape space of parameterized surfaces IEEE Trans Pattern Anal Mach Intell 34 9 1717 1730 2012 22144521
35 Kurtek S Srivastava A Klassen E Laga H Landmark-guided elastic shape analysis of spherically-parameterized surfaces Computer Graphics Forum 32 2 429 438 2013
36 Li S Yuan X Pu F Li D Fan Y Wu L Chao W Chen N He Y Han Y Abnormal changes of multidimensional surface features using multivariate pattern classification in amnestic mild cognitive impairment patients The Journal of Neuroscienc 34 32 1054 1055 2014
37 Lipman Y Daubechies I Conformal Wasserstein distances: Comparing surfaces in polynomial time Advances in Mathematics 227 3 1047 1077 2011
38 Lipman Y Puente J Daubechies I Conformal Wasserstein distance: II. computational aspects and extensions Math Comp 82 331 381 2013
39 Mémoli F Gromov-Wasserstein distances and the metric approach to object matching Foundations of Computational Mathematics 11 4 417 487 2011
40 Miller MI Trouve A Younes L On the metrics and Euler-Lagrange equations of computational anatomy Annu Rev Biomed Eng 4 375 405 2002 12117763
41 Peyré G Cohen L Geodesic remeshing using front propagation Int J Comput Vis 69 1 145 156 2006
42 Pizer SM Fritsch DS Yushkevich PA Johnson VE Chaney EL Segmentation, registration, and measurement of shape variation via image object shape IEEE Trans Med Imaging 18 10 851 865 1999 10628945
43 Raz N Lindenberger U Rodrigue KM Kennedy KM Head D Williamson A Dahle C Gerstorf D Acker JD Regional brain changes in aging healthy adults: general trends, individual differences and modifiers Cereb Cortex 15 11 1676 1689 2005 15703252
44 Rehman T Haber E Pryor G Melonakos J Tannenbauma A 3D nonrigid registration via optimal mass transport on the GPU Medical Image Analysis 13 6 931 940 2009 19135403
45 Schmitzer B Schnörr C Object segmentation by shape matching with Wasserstein modes Book Chaper of Energy Minimization Methods in Computer Vision and Pattern Recognition 8081 123 136 2013
46 Schoen R Yau S-T Lectures on Harmonic Maps International Press 1997
47 Shi J Collignon O Xu L Wang G Kang Y Leporé F Lao Y Joshi AA Leporé N Wang Y Impact of early and late visual deprivation on the structure of the corpus callosum: A study combining thickness profile with surface tensor-based morphometry Neuroinformatics 13 3 321 336 2015 25649876
48 Shi J Leporé N Gutman B Thompson PM Baxter LC Caselli RJ Wang Y Group A Genetic influence of APOE4 genotype on hippocampal morphometry - an N=725 surface-based Alzheimer’s Disease Neuroimaging Inituative study Human Brain Mapping 35 8 3903 3918 2014 24453132
49 Shi J Stonnington CM Thompson PM Chen K Gutman BA Reschke C Baxter LC Reiman EM Caselli RJ Wang Y Studying ventricular abnormalities in mild cognitive impairment with hyperbolic Ricci flow and tensor-based morphometry Neuro Image 104 1 1 20 2015 25285374
50 Shi R Zeng W Su Z Damasio H Lu Z Wang Y Yau S-T Gu X Hyperbolic harmonic mapping for constrained brain registration IEEE Computer Society Conference on Computer Vision and Pattern Recognition (CVPR) 2531 2538 2013
51 Solomon J de Goes F Peyré G Cuturi M Butscher A Nguyen A Du T Guibas L Convolutional wasserstein distances: Efficient optimal transportation on geometric domains ACM Transactions on Graphics 34 4 66 2015
52 Srivastava A Jermyn IH Looking for shapes in two-dimensional cluttered point clouds IEEE Trans Pattern Anal Mach Intell 31 9 1616 1629 2009 19574622
53 Srivastava A Joshi SH Mio W Liu X Statistical shape analysis: clustering, learning, and testing IEEE Trans Pattern Anal Mach Intell 27 4 590 602 2005 15794163
54 Styner M Gerig G Medial models incorporating object variability for 3D shape analysis Information Processing in Medical Imaging 171 178 2001
55 Styner M Oguz I Xu S Brechbühler C Pantazis D Levitt JJ Shenton ME Gerig G Framework for the statistical shape analysis of brain structures using SPHARM-PDM Insight Journal 1071 242 250 2006
56 Su Z Wang Y Shi R Zeng W Sun J Luo F Gu X Optimal mass transport for shape matching and comparison IEEE Trans Pattern Anal Mach Intell 37 11 2246 2259 2015 26440265
57 Su Z Zeng W Shi R Wang Y Sun J Gu X Area preserving brain mapping IEEE Computer Society Conference on Computer Vision and Pattern Recognition (CVPR) 2235 2242 2013
58 Su Z Zeng W Wang Y Lu Z-L Gu X Shape classification using Wasserstein distance for brain morphometry analysis Information Processing in Medical Imaging, International Conference (IPMI), Proceedings 411 423 2015
59 Thurston WP Geometry and Topology of Thre-Manifolds Princeton Lectures Notes 1976
60 Villani C Topics in Optimal Transportation American Mathematical Society 2003
61 Wang W Slepčev D Basu S Ozolek JA Rohde GK A linear optimal transportation framework for quantifying and visualizing variations in sets of images Int J Comput Vis 101 2 254 269 2013 23729991
62 Wang Y Chan TF Toga AW Thompson PM Multivariate tensor-based brain anatomical surface morphometry via holomorphic one-forms Medical Image Computing and Computer-Assisted Intervention 12 337 344 2009 20426005
63 Wang Y Dai W Chou Y Gu X Chan TF Toga AW Thompson PM Studying brain morphometry using conformal equivalence class 12th IEEE International Conference on Computer Vision (ICCV) 2365 2372 2009
64 Wang Y Dai W Gu X Chan TF Yau S-T Toga AW Thompson PM Teichmüller shape space theory and its application to brain morphometry Medical Image Computing and Computer-Assisted Intervention 133 140 2009 20426105
65 Wang Y Gu X Chan TF Thompson PM Shape analysis with conformal invariants for multiply connected domains and its application to analyzing brain morphology IEEE Computer Society Conference on Computer Vision and Pattern Recognition (CVPR) 202 209 2009
66 Wang Y Shi J Yin X Gu X Chan TF Yau ST Toga AW Thompson PM Brain surface conformal parameterizaiton with the Ricci flow IEEE Trans Med Imaging 31 2 251 264 2012 21926017
67 Younes L Spaces and manifolds of shapes in computer vision: An overview Image Vision Comput 30 6–7 389 397
68 Younes L Shapes and Diffeomorphisms Springer 2010
69 Younes L Arrate F Miller MI Evolutions equations in computational anatomy Neuroimage 45 1 Suppl 40 50 2009
70 Zeng W Samaras D Gu X Ricci Flow for 3D shape analysis IEEE Trans Pattern Anal Mach Intell 32 4 662 677 2010 20224122
71 Zhu L Haker S Tannenbaum A Area-preserving mappings for the visualization of medical structures Medical Image Computing and Computer-Assisted Intervention 2879 277 284 2003
